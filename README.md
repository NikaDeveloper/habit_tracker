# Трекер полезных привычек (Habit Tracker)

Бэкенд-часть SPA веб-приложения для отслеживания полезных привычек, разработанная в рамках курсового проекта. Проект вдохновлен книгой Джеймса Клира «Атомные привычки».

## Ссылки на проект
* **Swagger UI:** [http://34.173.72.233/swagger/](http://35.225.159.192/swagger/)
* **ReDoc:** [http://34.173.72.233/redoc/](http://35.225.159.192/redoc/)
* **Admin Panel:** [http://34.173.72.233/admin/](http://35.225.159.192/admin/)
*(Примечание: Корень сайта / возвращает 404, так как эндпоинты настроены для API и документации).*

## Основной функционал

* **CRUD для привычек:** Создание, чтение, редактирование и удаление привычек.
* **Валидация:** Сложная система проверки привычек (время выполнения < 120 с, запрет одновременного вознаграждения и связанной привычки и др.).
* **Пагинация:** Вывод списков привычек страницами (по 5 штук).
* **Публичные привычки:** Возможность публиковать привычки для общего доступа.
* **Интеграция с Telegram:** Асинхронная рассылка напоминаний о выполнении привычки через телеграм-бота.
* **CORS:** Настроен для взаимодействия с фронтендом.

## Стек технологий

* **Python 3.13 / Django 6.0 / DRF**
* **PostgreSQL** (БД) / **Redis** (Брокер)
* **Celery / Celery Beat** (Задачи по расписанию)
* **Nginx** (Reverse-proxy & Static delivery)
* **Docker / Docker Compose** (Контейнеризация)

### Docker и Деплой (CI/CD)

Проект полностью контейнеризирован и настроен для автоматического развертывания.

### Docker Compose
Приложение разворачивается в связке из 5 контейнеров:
* **app**: Django + Gunicorn (Backend)
* **db**: PostgreSQL (Database)
* **redis**: Redis (Broker)
* **nginx**: Reverse-proxy (раздача статики и маршрутизация)
* **celery_worker / beat**: Фоновые задачи

**Запуск через Docker:**
```bash
docker-compose up -d --build
```

## GitHub Actions (CI/CD)
В проекте настроен автоматизированный Pipeline (.github/workflows/ci.yml):

* **Lint:** Проверка кода на соответствие стандартам PEP8 (flake8).

* **Test:** Автоматический прогон тестов.

* **Build:** Сборка Docker-образа и пуш в Docker Hub.

* **Deploy:** Автоматическое обновление приложения на удаленном сервере (GCP) через SSH.


## Настройка удаленного сервера и Deployment

### 1. Подготовка сервера (Ubuntu 22.04+)
Для развертывания использовалась виртуальная машина на GCP. Основные шаги настройки:
1. Установлен Docker и Docker Compose (v2+).
2. Настроены SSH-ключи для доступа GitHub Actions к серверу.
3. В папке проекта на сервере создан файл `.env` с секретными данными (БД, токены, настройки Django).

### 2. Настройка CI/CD (GitHub Actions)
Для автоматического деплоя в GitHub Secrets были добавлены следующие переменные:
* `SSH_KEY` — приватный SSH-ключ для доступа к серверу.
* `SSH_USER` — имя пользователя на сервере.
* `SERVER_IP` — внешний IP-адрес сервера (34.173.72.233).
* `DOCKER_HUB_USERNAME` / `DOCKER_HUB_TOKEN` — данные для пуша образов.

### 3. Запуск деплоя
Workflow запускается автоматически при каждом `push` в ветку `feature/deploy` (или `main`).
**Шаги процесса:**
1. **Lint & Test**: Проверка кода и запуск тестов внутри CI.
2. **Build**: Сборка Docker-образа с тегом коммита и его отправка в Docker Hub.
3. **Deploy**: 
   - Подключение к серверу по SSH.
   - Выполнение `git pull` для обновления конфигураций (nginx, docker-compose).
   - Обновление тега образа в `.env` файле на сервере.
   - Команда `docker-compose up -d` для перезапуска контейнеров с новой версией образа.

## Тестирование

*Запуск тестов:*
```bash
python manage.py test
```

*Покрытие:*
```bash
coverage run --source='.' manage.py test && coverage report
```

*Автор
Nika Developer*
